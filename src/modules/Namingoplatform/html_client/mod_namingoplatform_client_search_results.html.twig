{% extends "mod_index.html.twig" %}

{% block meta_title %}Domain Search Results{% endblock %}

{% block content %}
<div class="domain-search-results">
    <div class="row">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1>Search Results for "{{ keyword }}"</h1>
                <a href="{{ 'namingoplatform/search'|link }}" class="btn btn-outline-primary">
                    <i class="fas fa-search"></i> New Search
                </a>
            </div>
        </div>
    </div>

    <!-- AI Suggestions -->
    {% if suggestions.ai_suggestions %}
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-robot"></i> AI-Powered Suggestions</h5>
                    <small class="text-muted">Generated by our advanced AI algorithms</small>
                </div>
                <div class="card-body">
                    {% for service, serviceSuggestions in suggestions.ai_suggestions %}
                        {% if serviceSuggestions.suggestions %}
                        <div class="ai-service-section mb-4">
                            <h6 class="ai-service-title">
                                <i class="fas fa-brain"></i> {{ serviceSuggestions.service }}
                                <span class="badge bg-info">{{ serviceSuggestions.total }} suggestions</span>
                            </h6>
                            <div class="row">
                                {% for suggestion in serviceSuggestions.suggestions %}
                                <div class="col-md-6 col-lg-4 mb-3">
                                    <div class="suggestion-card" data-domain="{{ suggestion.domain }}">
                                        <div class="suggestion-header">
                                            <h6 class="suggestion-domain">{{ suggestion.domain }}</h6>
                                            <div class="suggestion-score">
                                                <div class="score-bar">
                                                    <div class="score-fill" style="width: {{ suggestion.score }}%"></div>
                                                </div>
                                                <span class="score-text">{{ suggestion.score }}%</span>
                                            </div>
                                        </div>
                                        <div class="suggestion-info">
                                            {% if suggestion.category %}
                                            <span class="badge bg-secondary">{{ suggestion.category }}</span>
                                            {% endif %}
                                            {% if suggestion.style %}
                                            <span class="badge bg-light text-dark">{{ suggestion.style }}</span>
                                            {% endif %}
                                        </div>
                                        <div class="suggestion-actions">
                                            <button class="btn btn-sm btn-primary check-availability" 
                                                    data-domain="{{ suggestion.domain }}">
                                                <i class="fas fa-check"></i> Check Availability
                                            </button>
                                            <button class="btn btn-sm btn-outline-info analyze-domain" 
                                                    data-domain="{{ suggestion.domain }}">
                                                <i class="fas fa-chart-line"></i> Analyze
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Exact Matches -->
    {% if suggestions.exact_match %}
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-bullseye"></i> Exact Matches</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Domain</th>
                                    <th>Availability</th>
                                    <th>Price</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for match in suggestions.exact_match %}
                                <tr>
                                    <td>
                                        <strong>{{ match.domain }}</strong>
                                    </td>
                                    <td>
                                        {% if match.available %}
                                            <span class="badge bg-success">Available</span>
                                        {% else %}
                                            <span class="badge bg-danger">Taken</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if match.available %}
                                            <strong>€{{ match.price }}</strong>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if match.available %}
                                            <button class="btn btn-sm btn-success register-domain" 
                                                    data-domain="{{ match.domain }}" 
                                                    data-price="{{ match.price }}">
                                                <i class="fas fa-shopping-cart"></i> Register
                                            </button>
                                        {% else %}
                                            <button class="btn btn-sm btn-outline-secondary" disabled>
                                                <i class="fas fa-times"></i> Not Available
                                            </button>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Variations -->
    {% if suggestions.variations %}
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-random"></i> Variations</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for variation in suggestions.variations %}
                        <div class="col-md-3 col-sm-6 mb-2">
                            <div class="variation-item">
                                <span class="variation-domain">{{ variation }}</span>
                                <button class="btn btn-sm btn-outline-primary check-variation" 
                                        data-domain="{{ variation }}">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Premium Domains -->
    {% if suggestions.premium %}
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-crown"></i> Premium Domains</h5>
                    <small class="text-muted">High-value domains from premium marketplaces</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for domain, info in suggestions.premium %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="premium-domain-card">
                                <div class="premium-header">
                                    <h6>{{ domain }}</h6>
                                    <span class="premium-badge">Premium</span>
                                </div>
                                <div class="premium-info">
                                    <div class="price">€{{ info.price|number_format }}</div>
                                    <div class="marketplace">{{ info.marketplace }}</div>
                                </div>
                                <div class="premium-actions">
                                    <button class="btn btn-sm btn-warning view-premium" 
                                            data-domain="{{ domain }}" 
                                            data-price="{{ info.price }}">
                                        <i class="fas fa-eye"></i> View Details
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.suggestion-card {
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 15px;
    transition: all 0.3s;
    background: white;
    height: 100%;
}

.suggestion-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.suggestion-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.suggestion-domain {
    font-weight: bold;
    color: #333;
    margin: 0;
    flex: 1;
}

.suggestion-score {
    display: flex;
    align-items: center;
    gap: 8px;
}

.score-bar {
    width: 60px;
    height: 8px;
    background: #e9ecef;
    border-radius: 4px;
    overflow: hidden;
}

.score-fill {
    height: 100%;
    background: linear-gradient(90deg, #ff6b6b, #ffd93d, #6bcf7f);
    transition: width 0.3s;
}

.score-text {
    font-size: 0.8rem;
    font-weight: bold;
    color: #666;
}

.suggestion-info {
    margin-bottom: 10px;
}

.suggestion-actions {
    display: flex;
    gap: 5px;
}

.ai-service-section {
    border-bottom: 1px solid #e9ecef;
    padding-bottom: 20px;
}

.ai-service-section:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.ai-service-title {
    color: #007bff;
    margin-bottom: 15px;
}

.variation-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    border: 1px solid #e9ecef;
    border-radius: 4px;
    background: #f8f9fa;
}

.variation-domain {
    font-family: monospace;
    font-weight: bold;
}

.premium-domain-card {
    border: 2px solid #ffc107;
    border-radius: 8px;
    padding: 15px;
    background: linear-gradient(135deg, #fff9c4, #ffffff);
    text-align: center;
}

.premium-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.premium-badge {
    background: #ffc107;
    color: #000;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: bold;
}

.premium-info .price {
    font-size: 1.5rem;
    font-weight: bold;
    color: #ffc107;
}

.premium-info .marketplace {
    font-size: 0.9rem;
    color: #666;
}

.loading {
    opacity: 0.6;
    pointer-events: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Check availability buttons
    document.querySelectorAll('.check-availability, .check-variation').forEach(btn => {
        btn.addEventListener('click', function() {
            const domain = this.dataset.domain;
            checkDomainAvailability(domain, this);
        });
    });

    // Register domain buttons
    document.querySelectorAll('.register-domain').forEach(btn => {
        btn.addEventListener('click', function() {
            const domain = this.dataset.domain;
            const price = this.dataset.price;
            registerDomain(domain, price);
        });
    });

    // Analyze domain buttons
    document.querySelectorAll('.analyze-domain').forEach(btn => {
        btn.addEventListener('click', function() {
            const domain = this.dataset.domain;
            analyzeDomain(domain);
        });
    });

    // Premium domain buttons
    document.querySelectorAll('.view-premium').forEach(btn => {
        btn.addEventListener('click', function() {
            const domain = this.dataset.domain;
            const price = this.dataset.price;
            viewPremiumDomain(domain, price);
        });
    });
});

function checkDomainAvailability(domain, button) {
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
    button.disabled = true;
    
    // Simulate API call
    setTimeout(() => {
        const isAvailable = Math.random() > 0.5;
        if (isAvailable) {
            button.innerHTML = '<i class="fas fa-check"></i> Available';
            button.className = 'btn btn-sm btn-success';
        } else {
            button.innerHTML = '<i class="fas fa-times"></i> Taken';
            button.className = 'btn btn-sm btn-danger';
        }
    }, 1500);
}

function registerDomain(domain, price) {
    if (confirm(`Register ${domain} for €${price}?`)) {
        // Redirect to registration page
        window.location.href = `{{ 'order'|link }}?action=register&domain=${domain}&price=${price}`;
    }
}

function analyzeDomain(domain) {
    // Show domain analysis modal or redirect
    window.location.href = `{{ 'namingoplatform/domain/'|link }}${domain}`;
}

function viewPremiumDomain(domain, price) {
    alert(`Premium domain: ${domain}\nPrice: €${price}\n\nThis domain is available on premium marketplaces. Contact us for more information.`);
}
</script>
{% endblock %}